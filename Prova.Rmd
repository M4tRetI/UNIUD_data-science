---
title: "Prova"
author: "Matteo Remorini"
date: "2024-01-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Domande / spunti

  - Andamento del numero di atleti per edizione / per stato (magari animato da mostrare chi evenutalemtne ha spiccato)        DONE / ----
  - Andamento quote rosa per edizione                                                                                         DONE
  - Paesi che hanno ospitato più edizioni                                                                                     IMPOSSIBILE A CAUSA ASSOCIAZIONE CITTA - STATO
  - Paesi che hanno vinto più medaglie in totale                                                                              ANDAMENTO NEL TEMPO NON SIGNIFICATIVO, IN ASSOLUTO POCO INTERESSANTE
  - Gli atleti mediamente più alti tra i paesi (oggi) (50 anni fa) (prima)
  - Gli atleti mediamente più giovani tra i paesi (oggi) (50 anni fa) (prima)
  - 
  
  - I paesi ospitanti vincono di più?

```{r}
library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(treemapify)
library(gganimate)
```

```{r}
athletes <- read_csv("Dataset/athlete_events.csv") %>%
  select(-c("ID", "Games")) %>%
  filter(Year != 1906 & Season == "Summer" & !(Sport %in% c("Art Competitions")) ) %>%
  mutate(BMI = Weight/(Height/100)^2)
noc_regions <- read_csv("Dataset/noc_regions.csv")

athletes_f <- athletes[athletes$Sex == "F", ]
athletes_m <- athletes[athletes$Sex == "M", ]
winners <- athletes %>% na.omit(Medal)
```

<!-- potrebbe servire per fare sostanza (informazioni di base) -->
```{r}
# numero di atleti per sesso nell'arco del tempo
partecipanti <- athletes %>%
  group_by(Year, Sex) %>%
  summarize(value = n())
partecipanti[nrow(partecipanti)+1, ] <- list(2020,"F", 6608)
partecipanti[nrow(partecipanti)+1, ] <- list(2020,"M", 7219)

ggplot(partecipanti, aes(fill=Sex, y=value, x=Year)) + 
  geom_bar(position="stack", stat="identity") +
  scale_fill_manual("legend", values = c("F" = "#e665df", "M" = "#0d90d1")) +
  ggtitle("Numero di atleti per edizion") +
  theme_minimal()
```
> Il trend del numero di atleti è in crescita fino al 2000, rimanendo per lo più stazionario tranne un minimo nel 2012.
>Devono essere visti come separati perchè uno non preclude l'altro, sono due olimpiadi "parallele".
> A cosa è dovuta la crescita i picchi di minimo e soprattutto il calo di partecipazioni dal '90.
<!-- forse anche no -->


<!-- POTREBBE SERVIRE PER INTRODURRE ANALISI PIù INCENTRATA SUL NUOTO -->
```{r}
# Atleti per sport

# numero di sport nell'arco del tempo
sport_tempo_f <- table(athletes[athletes$Sex == "F", ]$Sport)/nrow(athletes[athletes$Sex == "F", ])*100
sport_tempo_m <- table(athletes[athletes$Sex == "M", ]$Sport)/nrow(athletes[athletes$Sex == "M", ])*100

ggplot(data.frame(sport_tempo_f), aes(area = Freq, label = paste(Var1, paste0(trunc(Freq*100)/100, "%"), sep ="\n"), subgroup = Var1, fill = Var1)) + 
  geom_treemap(layout = "fixed") +
  geom_treemap_text(colour = "white", place = "centre", layout="fixed") +
  ggtitle("Sport più giocati - Femmine") +
  theme_minimal() +
  theme(legend.position="none")

ggplot(data.frame(sport_tempo_m), aes(area = Freq, label = paste(Var1, paste0(trunc(Freq*100)/100, "%"), sep ="\n"), subgroup = Var1, fill = Var1)) + 
  geom_treemap(layout = "fixed") +
  geom_treemap_text(colour = "white", place = "centre", layout="fixed") +
  ggtitle("Sport più giocati - Maschi") +
  theme_minimal() +
  theme(legend.position="none")

```
<!-- forse anche no -->

<!-- lo userei come riempitivo, non informazioni importanti -->
```{r}
# Sport nei quali l'età non detta la competitività
hist(athletes_m$Age, freq = FALSE, breaks = 80, main = "Densità dell'età - Maschi")
hist(athletes_f$Age, freq = FALSE, breaks = 80, main = "Densità dell'età - Femmine")
summary(athletes_m)
summary(athletes_f)

# Ci sono diversi uomini e donne con un età oltre il terzo quartile che in media si attesta a 28 anni,
# quali sport praticano Rowing, Sailing, Gymnastics, Equestrianism, Fencing, Shooting, Athletics
athletes %>%
  filter(Sport %in% c("Sailing", "Equestrianism", "Fencing", "Shooting")) %>%       # sport meno dipendenti dall'età
  ggplot(aes(Age, fill = Medal)) +
    geom_histogram() +
    scale_fill_manual("legend", values = c("Gold" = "#FFDF00", "Silver" = "#C0C0C0", "Bronze" = "#CD7F32"), na.value = "#F0F0F0") +
    theme_minimal() +
    facet_wrap(vars(Sport))
```



### Andamento numero medagli per paese
```{r}
## INUTILE -----

# medal_noc_year <- athletes %>%
#   filter(!is.na(Medal)) %>%
#   group_by(NOC, Year) %>%
#   summarize(Medal = n()) %>%
#   mutate(NOC = replace(NOC, NOC == "URS", "RUS")) %>%
#   filter(NOC %in% c("USA", "RUS", "GER", "GBR", "FRA", "ITA", "CHN"))
# 
# ggplot(medal_noc_year, aes(y=Medal, x=Year, group = NOC, color = NOC)) + 
#   geom_line() +
#   ggtitle("Classifica medagliere nel tempo") +
#   theme_minimal()
# p <- +
#   transition_states(
#     Year,
#     transition_length = 50,
#     state_length = 0
#     ) +
#   ease_aes('sine-in-out') +
#   theme_minimal()
# 
# animate(p, fps=27, renderer = gifski_renderer(loop = FALSE))
  

# fig <- plot_geo(medal_noc_year)
# fig <- fig %>% add_trace(
#     z = ~Medal, text = ~Medal, locations = ~NOC,
#     color = ~Medal, colors = 'Blues'
#   )
# fig <- fig %>% colorbar(title = "Numero di medaglie")
# fig <- fig %>% layout(
#     title = 'Medaglie ricevute dai team nelle varie edizioni'
#   )
# 
# fig
```


### Altro


<!-- RISULTATO INTERESSANTE - DA INSERIRE -->
```{r}
# Gli atleti alti 183 cm hanno all'ìncirca 4 volte più probabilità rispetto alle altre altezze di vincere una medaglia
# QUESTO è SOLO MASCHI, FARE ANCHE PER FEMMINE

# individuo la probabilità di vincita (medaglia qualsiasi) di ogni altezza rispetto al totale
temp <- athletes_m %>%
  filter(Sport == "Swimming")
temp1 <- temp %>%
  na.omit(Medal)
temp2 <- temp1 %>%
  group_by(Height) %>%
  summarize(prob = n()/nrow(temp)) %>%
  arrange(prob)

ggplot(temp2, aes(x = Height, y = prob*100)) +
  geom_point() +
  geom_segment(aes(x = Height, xend = Height, y = 0, yend = prob*100)) +
  geom_hline(aes(yintercept=mean(prob*100)), color = "navyblue") +
  geom_text(aes(160,mean(prob*100),label = paste("Media:", mean(prob*100)), vjust = -1), color = "navyblue") +
  geom_segment(aes(x = 176, xend = 176, y = 0.22, yend = 0.88), color = "blue",
               arrow = arrow(length = unit(0.02, "npc"), ends = "both")) +
  geom_text(aes(174,0.6,label = "4x"), color = "blue", size = 7) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# ggplot(temp2, aes(x = reorder(Height, prob), y = prob*100)) +
#   geom_point() +
#   geom_segment(aes(x = reorder(Height, prob), xend = reorder(Height, prob), y = 0, yend = prob*100)) +
#   theme_minimal() +
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))



# summary(temp2) # media : 0.002106 ; max : 0.008819

```
```{r}
# Potrebbe essere ciò che mi porta a parlare del nuoto
# Lo sport in cui un aspetto fisico è più importante
# ALTEZZA - scontato

# ETA
winners %>%
  filter(Sport %in% c("Rhythmic Gymnastics", "Swimming", "Diving", "Gymnastics", "Figure Skating", "Equestrianism", "Golf", "Beach Volleyball")) %>%
ggplot(aes(x=reorder(Sport, Age, median), y=Age)) + 
  geom_boxplot() +
  geom_vline(aes(xintercept = 4.5), color = "blue") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# BMI - NON COSì INTERESANTE. weightlifting e rugby e roba di forza BMI alto, gli sport di grazia come ginnastica ritmica o nuoto sincronizzato bassa

# WEIGTH - COME BMI
```



<!-- fatto così sembra essere INUTILE -->
```{r}
ggplot(athletes[athletes$Sex == "M", ], aes(Height, fill = Medal, order = Medal)) +
  geom_histogram(binwidth = 0.5) +
  scale_fill_manual("legend", values = c("Gold" = "#FFDF00", "Silver" = "#C0C0C0", "Bronze" = "#CD7F32"), na.value = "#303030") +
  transition_states(
    Year,
    transition_length = 50,
    state_length = 0
  ) +
  ease_aes('sine-in-out') +
  theme_minimal()
```

<!-- gli istogrammi così sono utili per spiegare qualcosa in particolare, come info di background, altrimenti non vedo utilizzo fondamentale -->
```{r}
hist(athletes[athletes$Sex == "M", ]$BMI, breaks = 60)
hist(athletes[athletes$Sex == "F", ]$BMI, breaks = 60)

hist(athletes[athletes$Sex == "M", ]$Height, breaks = 60)
hist(athletes[athletes$Sex == "F", ]$Height, breaks = 60)

hist(athletes[athletes$Sex == "M", ]$Age, breaks = 60)
hist(athletes[athletes$Sex == "F", ]$Age, breaks = 60)
```



<!-- Potrebbe servire a qualcosa -->
```{r}
boxplot(Height ~ Year, athletes)
boxplot(Height ~ Age, athletes, subset = Sex == "M", range = 2)
boxplot(Height ~ Age, athletes, subset = Sex == "F", range = 2)
```


```{r}

```



