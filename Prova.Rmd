---
title: "Prova"
author: "Matteo Remorini"
date: "2024-01-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Domande / spunti

  - Andamento del numero di atleti per edizione / per stato (magari animato da mostrare chi evenutalemtne ha spiccato)        DONE / ----
  - Andamento quote rosa per edizione                                                                                         DONE
  - Paesi che hanno ospitato più edizioni                                                                                     IMPOSSIBILE A CAUSA ASSOCIAZIONE CITTA - STATO
  - Paesi che hanno vinto più medaglie in totale                                                                              ANDAMENTO NEL TEMPO NON SIGNIFICATIVO, IN ASSOLUTO POCO INTERESSANTE
  - Gli atleti mediamente più alti tra i paesi (oggi) (50 anni fa) (prima)
  - Gli atleti mediamente più giovani tra i paesi (oggi) (50 anni fa) (prima)
  - 
  
  - I paesi ospitanti vincono di più?

```{r}
library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)
# library(gganimate)
```

```{r}
athletes <- read_csv("Dataset/athlete_events.csv") %>%
  select(-c("ID", "Games")) %>%
  filter(Year != 1906 & Season == "Summer" & !(Sport %in% c("Art Competitions")) ) %>%
  mutate(BMI = Weight/(Height/100)^2)
noc_regions <- read_csv("Dataset/noc_regions.csv")

worldcities <- read_csv("Dataset/worldcities.csv") %>%
  select(city, country, iso3) %>%
  rename(City = city) %>%
  rbind(c(City = "Antwerpen", country = "Belgium", iso3 = "BEL")) %>%
  rbind(c(City = "Athina", country = "Greece", iso3 = "GRC")) %>%
  rbind(c(City = "Montreal", country = "Canada", iso3 = "CAN"))
```

### Andamento del numero di atleti per edizione, con la suddivisione per sesso
```{r}
athletes %>%
  group_by(Year, Sex) %>%
  summarize(value = n()) %>%
ggplot(aes(fill=Sex, y=value, x=Year)) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("Numero di atleti per edizioni") +
  scale_fill_manual("legend", values = c("F" = "#e665df", "M" = "#0d90d1")) +
  theme_minimal()
```

### Andamento numero medagli per paese
```{r}
## INUTILE -----

# medal_noc_year <- athletes %>%
#   filter(!is.na(Medal)) %>%
#   group_by(NOC, Year) %>%
#   summarize(Medal = n()) %>%
#   mutate(NOC = replace(NOC, NOC == "URS", "RUS")) %>%
#   filter(NOC %in% c("USA", "RUS", "GER", "GBR", "FRA", "ITA", "CHN"))
# 
# ggplot(medal_noc_year, aes(y=Medal, x=Year, group = NOC, color = NOC)) + 
#   geom_line() +
#   ggtitle("Classifica medagliere nel tempo") +
#   theme_minimal()
# p <- +
#   transition_states(
#     Year,
#     transition_length = 50,
#     state_length = 0
#     ) +
#   ease_aes('sine-in-out') +
#   theme_minimal()
# 
# animate(p, fps=27, renderer = gifski_renderer(loop = FALSE))
  

# fig <- plot_geo(medal_noc_year)
# fig <- fig %>% add_trace(
#     z = ~Medal, text = ~Medal, locations = ~NOC,
#     color = ~Medal, colors = 'Blues'
#   )
# fig <- fig %>% colorbar(title = "Numero di medaglie")
# fig <- fig %>% layout(
#     title = 'Medaglie ricevute dai team nelle varie edizioni'
#   )
# 
# fig
```

### Analisi
```{r}
# interessante analizzare la trasformate per capire quali relazioni o altro
# il fatto delle medaglie così è inutile (magari trovare altro o meglio abbandonare)
ggplot(athletes, aes(y=Height, x=Age, color = Medal)) + 
  geom_point() +
  ggtitle("Altezza-eta atleti e medagli vinte") +
  scale_color_manual("legend", values = c("Gold" = "#FFDF00", "Silver" = "#C0C0C0", "Bronze" = "#CD7F32"), na.value = "#F0F0F0") +
  theme_minimal()
ggplot(athletes, aes(y=Height, x=Weight, color = Medal)) + 
  geom_point() +
  ggtitle("Altezza-peso atleti e medagli vinte") +
  scale_color_manual("legend", values = c("Gold" = "#FFDF00", "Silver" = "#C0C0C0", "Bronze" = "#CD7F32"), na.value = "#F0F0F0") +
  theme_minimal()
ggplot(athletes, aes(y=Weight, x=Age, color = Medal)) + 
  geom_point() +
  ggtitle("Peso-eta atleti e medagli vinte") +
  scale_color_manual("legend", values = c("Gold" = "#FFDF00", "Silver" = "#C0C0C0", "Bronze" = "#CD7F32"), na.value = "#F0F0F0") +
  theme_minimal()
```

```{r}
# RISULTATO INTERESSANTE - POSSIBILMENTE : magari provare questa cosa con k-means per categorizzare
athletes %>%
  filter(Sex == "M", Year > 1944) %>%
ggplot(aes(y=BMI, x=Age, color = Sport)) + 
  geom_point(size = 0.8) +
  ggtitle("BMI-eta atleti e sport praticato") +
  theme_minimal()
```

```{r}
# sembra essere INUTILE
athletes %>%
  na.omit(Medal) %>%
ggplot(aes(y=Height, x=Sport, color = Medal)) + 
  geom_point(size = 0.8) +
  ggtitle("BMI-eta atleti e sport praticato") +
  scale_color_manual("legend", values = c("Gold" = "#FFDF00", "Silver" = "#C0C0C0", "Bronze" = "#CD7F32"), na.value = "#F0F0F0") +
  theme_minimal() +
  facet_wrap(vars(Medal))

# Approfondire questo aspetto
boxplot(Height ~ Sport, athletes)
```

```{r}
# fatto così sembra essere INUTILE, 
ggplot(athletes[athletes$Sex == "M", ], aes(Height, fill = Medal, order = Medal)) +
  geom_histogram(binwidth = 0.5) +
  scale_fill_manual("legend", values = c("Gold" = "#FFDF00", "Silver" = "#C0C0C0", "Bronze" = "#CD7F32"), na.value = "#303030") +
  transition_states(
    Year,
    transition_length = 50,
    state_length = 0
  ) +
  ease_aes('sine-in-out') +
  theme_minimal()
```

```{r}
# gli istogrammi così sono utili per spiegare qualcosa in particolare, come info di background, altrimenti non vedo utilizzo fondamentale
hist(athletes[athletes$Sex == "M", ]$BMI, breaks = 60)
hist(athletes[athletes$Sex == "F", ]$BMI, breaks = 60)

hist(athletes[athletes$Sex == "M", ]$Height, breaks = 60)
hist(athletes[athletes$Sex == "F", ]$Height, breaks = 60)

hist(athletes[athletes$Sex == "M", ]$Age, breaks = 60)
hist(athletes[athletes$Sex == "F", ]$Age, breaks = 60)
```

```{r}
athletes %>%
  na.omit(Medal) %>%
ggplot(aes(x=Year) + 
  geom_freqpoly(aes(color = Sex))) +
  ggtitle("Numero di medaglie per anno") +
  theme_minimal()
```

```{r}
# Potrebbe servire a qualcosa
boxplot(Height ~ Year, athletes)
boxplot(Height ~ Age, athletes, subset = Sex == "M", range = 2)
boxplot(Height ~ Age, athletes, subset = Sex == "F", range = 2)
```


```{r}

```


```{r}

```


